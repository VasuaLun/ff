-- Вставить несколько строк в таблицу
insert all
    into DV_ORGREG (NAME, CITY_ID, VERSION) values ('ВайфайКул',    1 , 1)
    into DV_ORGREG (NAME, CITY_ID, VERSION) values ('СпецВайфай',   1 , 1)
    into DV_ORGREG (NAME, CITY_ID, VERSION) values ('ТонронМост',   1 , 1)
    into DV_ORGREG (NAME, CITY_ID, VERSION) values ('Тонрон',       1 , 1)
    into DV_ORGREG (NAME, CITY_ID, VERSION) values ('Роновкор',     2 , 1)
    into DV_ORGREG (NAME, CITY_ID, VERSION) values ('Ронов',        2 , 1)
    into DV_ORGREG (NAME, CITY_ID, VERSION) values ('Торонпит',     2 , 1)
    into DV_ORGREG (NAME, CITY_ID, VERSION) values ('Торон',        2 , 1)
    into DV_ORGREG (NAME, CITY_ID, VERSION) values ('Жизньком',     2 , 1)
    into DV_ORGREG (NAME, CITY_ID, VERSION) values ('Соцсетикрона', 2 , 1)
    into DV_ORGREG (NAME, CITY_ID, VERSION) values ('КаналЛинк',    3 , 1)
    into DV_ORGREG (NAME, CITY_ID, VERSION) values ('Поисковиким',  3 , 1)
    into DV_ORGREG (NAME, CITY_ID, VERSION) values ('Сообщениямия', 3 , 1)
    into DV_ORGREG (NAME, CITY_ID, VERSION) values ('Риот',         3 , 1)
    into DV_ORGREG (NAME, CITY_ID, VERSION) values ('Алетта',       4 , 1)
    into DV_ORGREG (NAME, CITY_ID, VERSION) values ('Мелания',      4 , 1)
SELECT * FROM dual;

-- Заполнить все NULL значения определенным
update DV_ORGREG
    set VERSION = 1
where VERSION is NULL

-- Изменения значения ячеек в таблице
update DV_ORGREG
    set ADDRESS = 'Moscow, Lenina'
    where ID = 1;

-- Удаление столбца из таблицы

ALTER TABLE DV_SERVREG DROP COLUMN SERV_NAME;
-- Добавление столбца в таблицу
ALTER TABLE DV_SERVREG
ADD SERV_NAME VARCHAR(50) NULL;

-- Создание sequence
create sequence dv_test_sequence
start with 1
increment by 1;
------------------------------------------------------------------------

-- Заполнение таблицы услуг
insert all
into DV_SERVREG (ID, SERV_NAME, VERSION) values (1, 'широкополосный доступ в Интернет', 1)
into DV_SERVREG (ID, SERV_NAME, VERSION) values (2, 'беспроводной доступ в Интернет', 1)
into DV_SERVREG (ID, SERV_NAME, VERSION) values (3, 'выделение дискового пространства для хранения и обеспечения работы сайтов', 1)
into DV_SERVREG (ID, SERV_NAME, VERSION) values (4, 'поддержка электронных почтовых ящиков или виртуального почтового сервера', 1)
into DV_SERVREG (ID, SERV_NAME, VERSION) values (5, 'размещение оборудования клиента на площадке провайдера', 1)
into DV_SERVREG (ID, SERV_NAME, VERSION) values (6, 'аренда выделенных и виртуальных серверов (VPS, VDS)', 1)
into DV_SERVREG (ID, SERV_NAME, VERSION) values (7, 'резервирование данных', 1)
into DV_SERVREG (ID, SERV_NAME, VERSION) values (8, 'аренда сетевого оборудования', 1)
into DV_SERVREG (ID, SERV_NAME, VERSION) values (9, 'беспроводной доступ в Интернет', 2)
into DV_SERVREG (ID, SERV_NAME, VERSION) values (10, 'выделение дискового пространства для хранения и обеспечения работы сайтов', 2)
into DV_SERVREG (ID, SERV_NAME, VERSION) values (11, 'поддержка электронных почтовых ящиков или виртуального почтового сервера', 2)
into DV_SERVREG (ID, SERV_NAME, VERSION) values (12, 'размещение оборудования клиента на площадке провайдера', 2)
into DV_SERVREG (ID, SERV_NAME, VERSION) values (13, 'аренда выделенных и виртуальных серверов (VPS, VDS)', 2)
into DV_SERVREG (ID, SERV_NAME, VERSION) values (14, 'резервирование данных', 2)
into DV_SERVREG (ID, SERV_NAME, VERSION) values (15, 'аренда сетевого оборудования', 2)
SELECT * FROM dual;

-- Заполнение словаря-списка
insert all
    into DV_CITYDICTIONARY (ID, CITY_NAME) values (1, 'Москва')
    into DV_CITYDICTIONARY (ID, CITY_NAME) values (2, 'Санкт-Петербург')
    into DV_CITYDICTIONARY (ID, CITY_NAME) values (3, 'Самара')
    into DV_CITYDICTIONARY (ID, CITY_NAME) values (4, 'Новосибирск')
    into DV_CITYDICTIONARY (ID, CITY_NAME) values (5, 'Ростов')
SELECT * FROM dual;

-- Заполнение таблицы сопоставления услуг и организаций
insert all
    into DV_SERVLINKS (ORG_ID, SERV_ID, SEVRE_PRICE, VERSION) values (1, 1, 1000, 1)
    into DV_SERVLINKS (ORG_ID, SERV_ID, SEVRE_PRICE, VERSION) values (1, 2, 2000, 1)
    into DV_SERVLINKS (ORG_ID, SERV_ID, SEVRE_PRICE, VERSION) values (1, 3, 3000, 1)
    into DV_SERVLINKS (ORG_ID, SERV_ID, SEVRE_PRICE, VERSION) values (1, 4, 1200, 1)
    into DV_SERVLINKS (ORG_ID, SERV_ID, SEVRE_PRICE, VERSION) values (1, 5, 1300, 1)
    into DV_SERVLINKS (ORG_ID, SERV_ID, SEVRE_PRICE, VERSION) values (1, 6, 900 , 1)
    into DV_SERVLINKS (ORG_ID, SERV_ID, SEVRE_PRICE, VERSION) values (1, 7, 800 , 1)
    into DV_SERVLINKS (ORG_ID, SERV_ID, SEVRE_PRICE, VERSION) values (1, 8, 7400, 1)
    into DV_SERVLINKS (ORG_ID, SERV_ID, SEVRE_PRICE, VERSION) values (4, 1, 2488, 1)
    into DV_SERVLINKS (ORG_ID, SERV_ID, SEVRE_PRICE, VERSION) values (4, 3, 9800, 1)
    into DV_SERVLINKS (ORG_ID, SERV_ID, SEVRE_PRICE, VERSION) values (2, 2, 4500, 1)
    into DV_SERVLINKS (ORG_ID, SERV_ID, SEVRE_PRICE, VERSION) values (2, 3, 6500, 1)
    into DV_SERVLINKS (ORG_ID, SERV_ID, SEVRE_PRICE, VERSION) values (2, 6, 3000, 1)
    into DV_SERVLINKS (ORG_ID, SERV_ID, SEVRE_PRICE, VERSION) values (2, 7, 480 , 1)
    into DV_SERVLINKS (ORG_ID, SERV_ID, SEVRE_PRICE, VERSION) values (3, 1, 4560, 1)
    into DV_SERVLINKS (ORG_ID, SERV_ID, SEVRE_PRICE, VERSION) values (3, 7, 6854, 1)
    into DV_SERVLINKS (ORG_ID, SERV_ID, SEVRE_PRICE, VERSION) values (3, 2, 1547, 1)
    into DV_SERVLINKS (ORG_ID, SERV_ID, SEVRE_PRICE, VERSION) values (3, 4, 5623, 1)
    into DV_SERVLINKS (ORG_ID, SERV_ID, SEVRE_PRICE, VERSION) values (5, 7, 1405, 1)
    into DV_SERVLINKS (ORG_ID, SERV_ID, SEVRE_PRICE, VERSION) values (5, 1, 5870, 1)
    into DV_SERVLINKS (ORG_ID, SERV_ID, SEVRE_PRICE, VERSION) values (5, 2, 6540, 1)
    into DV_SERVLINKS (ORG_ID, SERV_ID, SEVRE_PRICE, VERSION) values (1, 1, 1000, 2)
    into DV_SERVLINKS (ORG_ID, SERV_ID, SEVRE_PRICE, VERSION) values (1, 2, 2000, 2)
    into DV_SERVLINKS (ORG_ID, SERV_ID, SEVRE_PRICE, VERSION) values (1, 3, 3000, 2)
    into DV_SERVLINKS (ORG_ID, SERV_ID, SEVRE_PRICE, VERSION) values (1, 4, 1200, 2)
    into DV_SERVLINKS (ORG_ID, SERV_ID, SEVRE_PRICE, VERSION) values (1, 5, 1300, 2)
    into DV_SERVLINKS (ORG_ID, SERV_ID, SEVRE_PRICE, VERSION) values (1, 6, 900 , 2)
    into DV_SERVLINKS (ORG_ID, SERV_ID, SEVRE_PRICE, VERSION) values (1, 7, 800 , 2)
    into DV_SERVLINKS (ORG_ID, SERV_ID, SEVRE_PRICE, VERSION) values (1, 8, 7400, 2)
    into DV_SERVLINKS (ORG_ID, SERV_ID, SEVRE_PRICE, VERSION) values (4, 1, 2488, 2)
    into DV_SERVLINKS (ORG_ID, SERV_ID, SEVRE_PRICE, VERSION) values (4, 3, 9800, 2)
    into DV_SERVLINKS (ORG_ID, SERV_ID, SEVRE_PRICE, VERSION) values (2, 2, 4500, 2)
    into DV_SERVLINKS (ORG_ID, SERV_ID, SEVRE_PRICE, VERSION) values (2, 3, 6500, 2)
    into DV_SERVLINKS (ORG_ID, SERV_ID, SEVRE_PRICE, VERSION) values (2, 6, 3000, 2)
    into DV_SERVLINKS (ORG_ID, SERV_ID, SEVRE_PRICE, VERSION) values (2, 7, 480 , 2)
    into DV_SERVLINKS (ORG_ID, SERV_ID, SEVRE_PRICE, VERSION) values (3, 1, 4560, 2)
    into DV_SERVLINKS (ORG_ID, SERV_ID, SEVRE_PRICE, VERSION) values (5, 2, 6540, 2)
    into DV_SERVLINKS (ORG_ID, SERV_ID, SEVRE_PRICE, VERSION) values (3, 7, 6854, 2)
    into DV_SERVLINKS (ORG_ID, SERV_ID, SEVRE_PRICE, VERSION) values (3, 2, 1547, 2)
    into DV_SERVLINKS (ORG_ID, SERV_ID, SEVRE_PRICE, VERSION) values (3, 4, 5623, 2)
    into DV_SERVLINKS (ORG_ID, SERV_ID, SEVRE_PRICE, VERSION) values (5, 7, 1405, 2)
    into DV_SERVLINKS (ORG_ID, SERV_ID, SEVRE_PRICE, VERSION) values (5, 1, 5870, 2)
SELECT * FROM dual;

-- Двухуровненвый Join для связи компаний и предоставляемых ими услуг
select org.NAME as orgname, serv.SERV_NAME as servname
from DV_ORGREG org
inner join DV_SERVLINKS link on org.ID = link.ORG_ID
inner join DV_SERVREG serv on link.SERV_ID = serv.ID;

select "ROWID",
"ORG_ID",
"SERV_ID"
from "#OWNER#"."DV_SERVLINKS"


-- Отображение таблицы на странице Учреждения VER 0 (без услуг)
select DV_ORGREG.NAME as NAME,
    DV_CITYDICTIONARY.CITY_NAME as CITY_NAME
 from DV_ORGREG DV_ORGREG,
    DV_CITYDICTIONARY DV_CITYDICTIONARY
 where DV_CITYDICTIONARY.ID=DV_ORGREG.CITY_ID

 -- Отображение таблицы на странице Учреждения VER 1 (с количеством услуг)
select DV_ORGREG.NAME as NAME,
     DV_CITYDICTIONARY.CITY_NAME as CITY_NAME,
     (select COUNT(*) as SERV_COUNT
     from DV_ORGREG DV_ORGREG,
        DV_SERVLINKS DV_SERVLINKS
     where DV_ORGREG.ID = DV_SERVLINKS.ORG_ID
     group by DV_SERVLINKS.ORG_ID)
  from DV_ORGREG DV_ORGREG,
     DV_CITYDICTIONARY DV_CITYDICTIONARY
  where DV_CITYDICTIONARY.ID=DV_ORGREG.CITY_ID

select COUNT(*) as SERV_COUNT
  from DV_ORGREG DV_ORGREG,
     DV_SERVLINKS DV_SERVLINKS
  where DV_ORGREG.ID = DV_SERVLINKS.ORG_ID
  group by DV_SERVLINKS.ORG_ID

select DV_ORGREG.NAME as NAME,
     DV_CITYDICTIONARY.CITY_NAME as CITY_NAME,
     COUNT(DV_SERVLINKS.SERV_ID) as SERV_COUNT
    from DV_ORGREG DV_ORGREG, DV_SERVLINKS DV_SERVLINKS
    left join DV_SERVLINKS DV_SERVLINKS
    on DV_SERVLINKS.ORG_ID = DV_ORGREG.ID
    where DV_ORGREG.ID = DV_SERVLINKS.ORG_ID and
    DV_ORGREG.ID = DV_SERVLINKS.ORG_ID
    group by DV_SERVLINKS.ORG_ID


    select serv.SERV_NAME as display_value, serv.ID as return_value
    from DV_SERVREG serv
    inner join DV_SERVLINKS link on link.SERV_ID = serv.ID
    inner join DV_ORGREG org on link.ORG_ID = org.ID
    where link.ORG_ID = :P22_ID_ORG;

-- Услуги по датам Ver 1
select org.NAME, servejourn.SERV_DATE,
COUNT(servejourn.ID_SERV) as SERV_COUNT
    from DV_ORGREG org,
        DV_SERVJOURNAL servejourn
    where org.ID = servejourn.ID_ORG
    group by servejourn.SERV_DATE, org.NAME
    order by servejourn.SERV_DATE

-- Услуги по датам Ver 2
select org.NAME, servejourn.SERV_DATE,
COUNT(servejourn.ID_SERV) as SERV_COUNT,
SUM()
    from DV_ORGREG org,
        DV_SERVJOURNAL servejourn
    where org.ID = servejourn.ID_ORG
    group by servejourn.SERV_DATE, org.NAME
    order by servejourn.SERV_DATE

-- История совершения услуг Ver 1
select DV_ORGREG.NAME as NAME,
    DV_SERVREG.SERV_NAME as SERV_NAME,
    DV_SERVLINKS.SEVRE_PRICE as SEVRE_PRICE,
    DV_SERVJOURNAL.SERV_DATE as SERV_DATE
 from DV_ORGREG DV_ORGREG,
    DV_SERVJOURNAL DV_SERVJOURNAL,
    DV_SERVREG DV_SERVREG,
    DV_SERVLINKS DV_SERVLINKS
 where DV_SERVJOURNAL.ID_ORG=DV_ORGREG.ID
    and DV_SERVJOURNAL.ID_SERV=DV_SERVREG.ID
    and DV_SERVLINKS.SERV_ID=DV_SERVREG.ID
 order by DV_SERVJOURNAL.SERV_DATE ASC, DV_ORGREG.NAME ASC, DV_SERVREG.SERV_NAME ASC

 -- История совершения услуг Ver2
 select DV_ORGREG.NAME as NAME,
     DV_SERVREG.SERV_NAME as SERV_NAME,
     DV_SERVLINKS.SEVRE_PRICE as SEVRE_PRICE,
     DV_SERVJOURNAL.SERV_DATE as SERV_DATE
  from DV_ORGREG DV_ORGREG,
     DV_SERVLINKS DV_SERVLINKS,
     DV_SERVREG DV_SERVREG,
     DV_SERVJOURNAL DV_SERVJOURNAL
  where DV_SERVJOURNAL.ID_ORG=DV_ORGREG.ID
     and DV_SERVJOURNAL.ID_SERV=DV_SERVREG.ID
     and DV_SERVREG.ID=DV_SERVLINKS.SERV_ID
     and DV_ORGREG.ID=DV_SERVLINKS.ORG_ID
  order by DV_SERVJOURNAL.SERV_DATE ASC, DV_ORGREG.NAME ASC, DV_SERVREG.SERV_NAME ASC

  -- Услуги компаний отображение
  select DV_ORGREG.NAME as NAME,
    DV_SERVREG.SERV_NAME as SERV_NAME,
    DV_SERVLINKS.SEVRE_PRICE as SEVRE_PRICE
 from DV_SERVREG DV_SERVREG,
    DV_ORGREG DV_ORGREG,
    DV_SERVLINKS DV_SERVLINKS
 where DV_ORGREG.ID=DV_SERVLINKS.ORG_ID
    and DV_SERVLINKS.SERV_ID=DV_SERVREG.ID
 order by DV_ORGREG.NAME ASC, DV_SERVREG.SERV_NAME ASC

 select o.ROWID, o.NAME as NAME,
     t.CITY_NAME as CITY_NAME
  from DV_ORGREG o,
     DV_CITYDICTIONARY t
  where (t.ID=o.CITY_ID(+) and o.CITY_ID = :P16_CITY and
 UPPER(o.NAME) like UPPER('%'||:P16_SEARCH||'%')) or
 (t.ID=o.CITY_ID(+) and :P16_CITY is NULL and
 UPPER(o.NAME) like UPPER('%'||:P16_SEARCH||'%'))

 -- Исправленное отображение для Статистики (с учетом версий)
 select j.ROWID, o.NAME as NAME,
     s.SERV_NAME as SERV_NAME,
     L.SEVRE_PRICE as SEVRE_PRICE,
     j.SERV_DATE as SERV_DATE
  from DV_ORGREG o,
     DV_SERVLINKS L,
     DV_SERVREG s,
     DV_SERVJOURNAL j
  where j.ID_ORG=o.A_ID
     and j.ID_SERV=s.A_SERVEID
     and s.ID=L.SERV_ID
     and o.ID=L.ORG_ID
     and j.VERSION = :P1_VERSION
  order by j.SERV_DATE ASC, o.NAME ASC, s.SERV_NAME ASC

  begin
  htp.p('<table border = "1" class="uReport uReportStandard">');
    for rec in
    (
  select ROWID, ID,
  SERV_NAME
  from DV_SERVREG where VERSION = :P1_VERSION
    )LOOP

      htp.p('<tr>');
          htp.p('<td style="background-color: yellow">'||'<a href="f?p=103:19:'||v('APP_SESSION')||'::NO::P19_ID:'||rec.ID||'">Edit</a></td>');
          htp.p('<td><div style="color:red"><b>'||rec.SERV_NAME||'</b></div></td>');
      htp.p('</tr>');
    END LOOP;
   htp.p('</table>');
  end;

-- Пример с массивом для "selecta"
  declare
  type arrayNAME is varray(34) of integer;
  array arrayNAME := arrayNAME();
  begin
  end;

  set serveroutput on size unlimited;
  DECLARE
     TYPE  XX_VAR_TYPE IS VARRAY(100)  OF  NUMBER  ;
     l_array  XX_VAR_TYPE :=  XX_VAR_TYPE(100,200,300,400,500);
    BEGIN
     l_array.TRIM(3);
     FOR I IN 1..l_array.COUNT
     LOOP
     DBMS_OUTPUT.PUT_LINE(l_array(I));
     END LOOP;
   END;

-- Проба работы с ассоциацивным массивом данных
DECLARE
   TYPE ID_t IS TABLE OF DV_ORGREG.ID%TYPE;
   TYPE NAME_t IS TABLE OF DV_ORGREG.NAME%TYPE;
   IDs ID_t;
   NAMEs NAME_t;
BEGIN
   SELECT ID, NAME BULK COLLECT INTO IDs, NAMEs
      FROM DV_ORGREG;
  FOR I IN 1..IDs.COUNT
  LOOP
  DBMS_OUTPUT.PUT_LINE(NAMEs(I));
  END LOOP;
END;

 DECLARE
     TYPE list_of_names_t IS TABLE OF VARCHAR2 (100);

     happyfamily   list_of_names_t := list_of_names_t ();
     children      list_of_names_t := list_of_names_t ();
     parents       list_of_names_t := list_of_names_t ();
  BEGIN
     happyfamily.EXTEND (4);
     happyfamily (1) := ‘Veva’;
     happyfamily (2) := ‘Chris’;
     happyfamily (3) := ‘Eli’;
     happyfamily (4) := ‘Steven’;

     children.EXTEND;
     children (children.LAST) := ‘Chris’;
     children.EXTEND;
     children (children.LAST) := ‘Eli’;

     parents := happyfamily MULTISET EXCEPT children;

     FOR l_row IN 1 .. parents.COUNT
     LOOP
        DBMS_OUTPUT.put_line (parents (l_row));
     END LOOP;
  END;

declare
 TYPE t_tab1 IS RECORD(
    RN number,
    CODE varchar2(100),
    PRN number
 );
 TYPE t_tab_arr1 IS TABLE OF t_tab1;
 regcode T_TAB_ARR1;
begin
    
end;
